<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenAlpha - Executive Carbon Intelligence Dashboard</title>
    
    <!-- Chart.js and modern libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: auto;
        }
        
        .dashboard-header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section h1 {
            color: #1e3c72;
            font-size: 2.2em;
            font-weight: 700;
        }
        
        .logo-section p {
            color: #666;
            font-size: 1.1em;
            margin-top: 5px;
        }
        
        .header-metrics {
            display: flex;
            gap: 30px;
        }
        
        .metric-item {
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 3px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .main-content {
            display: grid;
            gap: 30px;
        }
        
        .sidebar {
            display: grid;
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #1e3c72;
        }
        
        .card-subtitle {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .large-chart {
            height: 400px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .kpi-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f5e8 100%);
            border-radius: 12px;
            border-left: 4px solid #1e3c72;
        }
        
        .kpi-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .kpi-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .trend-up {
            background: #fee;
            color: #d63031;
        }
        
        .trend-down {
            background: #eef;
            color: #00b894;
        }
        
        .control-panel {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 8px;
        }
        
        .control-group select, .control-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .control-group select:focus, .control-group input:focus {
            outline: none;
            border-color: #1e3c72;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1a3660 0%, #245083 100%);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #009f7f 0%, #008f76 100%);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: white;
            color: #1e3c72;
            border: 2px solid #1e3c72;
        }
        
        .btn-outline:hover {
            background: #1e3c72;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #1e3c72;
        }
        
        .loading-spinner {
            border: 3px solid #e0e0e0;
            border-top: 3px solid #1e3c72;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d1f2eb;
            color: #0d7353;
            border-left: 4px solid #00b894;
        }
        
        .alert-error {
            background: #fadbd8;
            color: #922b21;
            border-left: 4px solid #e74c3c;
        }
        
        .alert-info {
            background: #d6eaf8;
            color: #1b4f72;
            border-left: 4px solid #3498db;
        }
        
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .header-metrics {
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                justify-content: stretch;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="logo-section">
                <h1>🌱 GreenAlpha</h1>
                <p>Executive Carbon Intelligence Dashboard</p>
            </div>
            <div class="header-metrics" id="headerMetrics">
                <div class="metric-item">
                    <div class="metric-value" id="totalEmissionsToday">0</div>
                    <div class="metric-label">Total CO₂ Today (kg)</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="calculationsToday">0</div>
                    <div class="metric-label">Calculations</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" id="avgResponseTime">0ms</div>
                    <div class="metric-label">Avg Response</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value status-indicator online" id="systemStatus">●</div>
                    <div class="metric-label">System Status</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-grid">
                <div class="control-group">
                    <label for="productSelect">Product Type</label>
                    <select id="productSelect">
                        <option value="smartphone">📱 Smartphone</option>
                        <option value="laptop">💻 Laptop</option>
                        <option value="t-shirt">👕 T-shirt</option>
                        <option value="tablet">📱 Tablet</option>
                        <option value="jeans">👖 Jeans</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="originSelect">Origin</label>
                    <select id="originSelect">
                        <option value="CHN">🇨🇳 China</option>
                        <option value="USA">🇺🇸 United States</option>
                        <option value="DEU">🇩🇪 Germany</option>
                        <option value="JPN">🇯🇵 Japan</option>
                        <option value="IND">🇮🇳 India</option>
                        <option value="GBR">🇬🇧 United Kingdom</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="destinationSelect">Destination</label>
                    <select id="destinationSelect">
                        <option value="USA">🇺🇸 United States</option>
                        <option value="DEU">🇩🇪 Germany</option>
                        <option value="JPN">🇯🇵 Japan</option>
                        <option value="GBR">🇬🇧 United Kingdom</option>
                        <option value="CHN">🇨🇳 China</option>
                        <option value="IND">🇮🇳 India</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="transportSelect">Transport Mode</label>
                    <select id="transportSelect">
                        <option value="air_freight">✈️ Air Freight</option>
                        <option value="sea_freight">🚢 Sea Freight</option>
                        <option value="road_truck">🚛 Road Truck</option>
                        <option value="rail">🚂 Rail</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="quantityInput">Quantity</label>
                    <input type="number" id="quantityInput" value="1" min="1" max="10000">
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="calculateCarbon()">
                    🧮 Calculate Carbon Footprint
                </button>
                <button class="btn btn-secondary" onclick="optimizeRoute()">
                    🚀 Optimize Transport
                </button>
                <button class="btn btn-outline" onclick="generateReport()">
                    📊 Generate Report
                </button>
                <button class="btn btn-outline" onclick="exportData()">
                    📥 Export Data
                </button>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Emissions Overview Chart -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Carbon Footprint Analysis</div>
                            <div class="card-subtitle">Real-time emissions breakdown by source</div>
                        </div>
                    </div>
                    <div class="chart-container large-chart">
                        <canvas id="emissionsChart"></canvas>
                    </div>
                </div>

                <!-- Transport Comparison -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Transport Mode Comparison</div>
                            <div class="card-subtitle">CO₂ emissions by transportation method</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="transportChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- KPI Cards -->
                <div class="card">
                    <div class="card-title">Key Performance Indicators</div>
                    <div class="kpi-grid">
                        <div class="kpi-item">
                            <div class="kpi-value" id="currentEmissions">0</div>
                            <div class="kpi-label">Current CO₂ (kg)</div>
                            <div class="trend-indicator trend-up" id="emissionsTrend">
                                ↑ 0%
                            </div>
                        </div>
                        <div class="kpi-item">
                            <div class="kpi-value" id="carbonCost">$0</div>
                            <div class="kpi-label">Carbon Cost</div>
                            <div class="trend-indicator trend-down" id="costTrend">
                                ↓ 0%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Performance -->
                <div class="card">
                    <div class="card-title">System Performance</div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <!-- Carbon Credit Opportunities -->
                <div class="card">
                    <div class="card-title">Carbon Arbitrage</div>
                    <div class="card-subtitle">Market opportunities</div>
                    <div id="arbitrageData" class="loading">
                        <div class="loading-spinner"></div>
                        Loading arbitrage data...
                    </div>
                </div>

                <!-- Supplier Recommendations -->
                <div class="card">
                    <div class="card-title">Supplier Analysis</div>
                    <div class="card-subtitle">Optimized recommendations</div>
                    <div id="supplierData" class="loading">
                        <div class="loading-spinner"></div>
                        Loading supplier data...
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Row Charts -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Historical Trends</div>
                        <div class="card-subtitle">Emission patterns over time</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendsChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Country Comparison</div>
                        <div class="card-subtitle">Emissions by manufacturing region</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="countryChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        const API_BASE = 'http://localhost:8000';
        let charts = {};
        let dashboardData = {
            calculations: [],
            performance: [],
            arbitrage: null,
            suppliers: null
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadInitialData();
            startPerformanceMonitoring();
            
            // Set default values
            document.getElementById('originSelect').value = 'CHN';
            document.getElementById('destinationSelect').value = 'USA';
            document.getElementById('transportSelect').value = 'air_freight';
        });

        // Initialize all charts
        function initializeCharts() {
            // Emissions breakdown chart
            const emissionsCtx = document.getElementById('emissionsChart').getContext('2d');
            charts.emissions = new Chart(emissionsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Production', 'Transportation', 'Packaging', 'End-of-Life'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#FF6B6B',
                            '#4ECDC4', 
                            '#45B7D1',
                            '#96CEB4'
                        ],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            font: {
                                weight: 'bold'
                            },
                            formatter: (value, ctx) => {
                                if (value === 0) return '';
                                let sum = ctx.dataset.data.reduce((a, b) => a + b, 0);
                                let percentage = Math.round((value / sum) * 100);
                                return percentage + '%';
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Transport comparison chart
            const transportCtx = document.getElementById('transportChart').getContext('2d');
            charts.transport = new Chart(transportCtx, {
                type: 'bar',
                data: {
                    labels: ['Air Freight', 'Sea Freight', 'Road Truck', 'Rail'],
                    datasets: [{
                        label: 'CO₂ Emissions (kg)',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#FF6B6B',
                            '#4ECDC4',
                            '#FFD93D',
                            '#6BCF7F'
                        ],
                        borderRadius: 8,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f0f0f0'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Performance monitoring chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            charts.performance = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: [],
                        borderColor: '#1e3c72',
                        backgroundColor: 'rgba(30, 60, 114, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1000,
                            grid: {
                                color: '#f0f0f0'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Historical trends chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            charts.trends = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Average Emissions',
                        data: [],
                        borderColor: '#00b894',
                        backgroundColor: 'rgba(0, 184, 148, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });

            // Country comparison chart
            const countryCtx = document.getElementById('countryChart').getContext('2d');
            charts.country = new Chart(countryCtx, {
                type: 'radar',
                data: {
                    labels: ['China', 'USA', 'Germany', 'Japan', 'India', 'UK'],
                    datasets: [{
                        label: 'Emission Factor',
                        data: [0.8, 0.4, 0.3, 0.5, 0.9, 0.3],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        pointBackgroundColor: '#e74c3c',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 1,
                            grid: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });
        }

        // Calculate carbon footprint
        async function calculateCarbon() {
            const startTime = Date.now();
            
            const requestData = {
                product_name: document.getElementById('productSelect').value,
                quantity: parseInt(document.getElementById('quantityInput').value),
                origin_country: document.getElementById('originSelect').value,
                destination_country: document.getElementById('destinationSelect').value,
                transport_mode: document.getElementById('transportSelect').value
            };

            // Show loading state
            showAlert('info', '🔄 Calculating carbon footprint...');

            try {
                const response = await fetch(`${API_BASE}/carbon/calculate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const responseTime = Date.now() - startTime;

                // Update dashboard with results
                updateDashboardData(data, responseTime);
                showAlert('success', `✅ Calculation completed in ${responseTime}ms`);

            } catch (error) {
                console.error('Calculation error:', error);
                showAlert('error', `❌ ${error.message}`);
            }
        }

        // Update dashboard with calculation results
        function updateDashboardData(data, responseTime) {
            // Store calculation
            dashboardData.calculations.push({
                ...data,
                responseTime,
                timestamp: new Date()
            });

            // Update KPIs
            document.getElementById('currentEmissions').textContent = data.total_emissions_kg_co2e.toFixed(1);
            document.getElementById('carbonCost').textContent = `$${(data.total_emissions_kg_co2e * 0.025).toFixed(2)}`;

            // Update header metrics
            const totalToday = dashboardData.calculations.reduce((sum, calc) => sum + calc.total_emissions_kg_co2e, 0);
            const avgResponse = dashboardData.calculations.reduce((sum, calc) => sum + calc.responseTime, 0) / dashboardData.calculations.length;
            
            document.getElementById('totalEmissionsToday').textContent = totalToday.toFixed(1);
            document.getElementById('calculationsToday').textContent = dashboardData.calculations.length;
            document.getElementById('avgResponseTime').textContent = `${Math.round(avgResponse)}ms`;

            // Update emissions breakdown chart
            updateEmissionsChart(data);

            // Update transport comparison
            updateTransportComparison();

            // Update performance monitoring
            updatePerformanceChart(responseTime);

            // Update trends
            updateTrendsChart();
        }

        // Update emissions breakdown chart
        function updateEmissionsChart(data) {
            const packaging = data.total_emissions_kg_co2e * 0.1; // Estimate 10% packaging
            const endOfLife = data.total_emissions_kg_co2e * 0.05; // Estimate 5% end-of-life
            
            charts.emissions.data.datasets[0].data = [
                data.production_emissions,
                data.transportation_emissions,
                packaging,
                endOfLife
            ];
            charts.emissions.update();
        }

        // Update transport comparison chart
        async function updateTransportComparison() {
            try {
                const requestData = {
                    product_name: document.getElementById('productSelect').value,
                    quantity: parseInt(document.getElementById('quantityInput').value),
                    origin_country: document.getElementById('originSelect').value,
                    destination_country: document.getElementById('destinationSelect').value
                };

                const transportModes = ['air_freight', 'sea_freight', 'road_truck', 'rail'];
                const emissions = [];

                for (const mode of transportModes) {
                    try {
                        const response = await fetch(`${API_BASE}/carbon/calculate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ...requestData, transport_mode: mode })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            emissions.push(data.total_emissions_kg_co2e);
                        } else {
                            emissions.push(0);
                        }
                    } catch {
                        emissions.push(0);
                    }
                }

                charts.transport.data.datasets[0].data = emissions;
                charts.transport.update();

            } catch (error) {
                console.error('Transport comparison error:', error);
            }
        }

        // Update performance monitoring chart
        function updatePerformanceChart(responseTime) {
            dashboardData.performance.push({
                time: new Date().toLocaleTimeString(),
                responseTime: responseTime
            });

            // Keep only last 20 data points
            if (dashboardData.performance.length > 20) {
                dashboardData.performance.shift();
            }

            charts.performance.data.labels = dashboardData.performance.map(p => p.time);
            charts.performance.data.datasets[0].data = dashboardData.performance.map(p => p.responseTime);
            charts.performance.update();
        }

        // Update trends chart
        function updateTrendsChart() {
            if (dashboardData.calculations.length < 2) return;

            const last10 = dashboardData.calculations.slice(-10);
            const labels = last10.map((_, i) => `Calc ${i + 1}`);
            const data = last10.map(calc => calc.total_emissions_kg_co2e);

            charts.trends.data.labels = labels;
            charts.trends.data.datasets[0].data = data;
            charts.trends.update();
        }

        // Optimize transport route
        async function optimizeRoute() {
            showAlert('info', '🚀 Finding optimal transport route...');
            
            try {
                const response = await fetch(`${API_BASE}/transport/optimize/route`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        origin: document.getElementById('originSelect').options[document.getElementById('originSelect').selectedIndex].text.split(' ')[1],
                        destination: document.getElementById('destinationSelect').options[document.getElementById('destinationSelect').selectedIndex].text.split(' ')[1],
                        weight_tonnes: parseFloat(document.getElementById('quantityInput').value) * 0.001,
                        priority: 'carbon'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const bestRoute = data.routes[0];
                    showAlert('success', `✅ Optimal route: ${bestRoute.mode} - ${bestRoute.emissions_kg_per_tonne.toFixed(2)} kg CO₂/tonne`);
                } else {
                    showAlert('error', '❌ Route optimization not available for selected locations');
                }
            } catch (error) {
                showAlert('error', `❌ Route optimization failed: ${error.message}`);
            }
        }

        // Load initial data
        async function loadInitialData() {
            // Load arbitrage data
            try {
                const response = await fetch(`${API_BASE}/arbitrage/market-opportunities-summary`);
                if (response.ok) {
                    const data = await response.json();
                    updateArbitrageDisplay(data);
                }
            } catch (error) {
                document.getElementById('arbitrageData').innerHTML = '❌ Failed to load arbitrage data';
            }

            // Load supplier data
            try {
                const response = await fetch(`${API_BASE}/recommendations/recommend/suppliers`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        weights: {
                            esg_score: 0.4,
                            cost_index: 0.3,
                            reliability_score: 0.2,
                            geographic_proximity: 0.1
                        },
                        top_n: 3
                    })
                });
                if (response.ok) {
                    const data = await response.json();
                    updateSupplierDisplay(data);
                }
            } catch (error) {
                document.getElementById('supplierData').innerHTML = '❌ Failed to load supplier data';
            }
        }

        // Update arbitrage display
        function updateArbitrageDisplay(data) {
            const html = `
                <div style="font-size: 0.9em; line-height: 1.4;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Market Opportunities:</span>
                        <strong>${data.market_summary.arbitrage_opportunities.price_differentials_found}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Max Profit:</span>
                        <strong>$${data.market_summary.arbitrage_opportunities.max_profit_per_tonne}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Avg ROI:</span>
                        <strong>${data.market_summary.arbitrage_opportunities.average_roi_percent.toFixed(1)}%</strong>
                    </div>
                </div>
            `;
            document.getElementById('arbitrageData').innerHTML = html;
        }

        // Update supplier display
        function updateSupplierDisplay(data) {
            const topSuppliers = data.items.slice(0, 3);
            const html = topSuppliers.map(supplier => `
                <div style="padding: 10px 0; border-bottom: 1px solid #eee;">
                    <div style="font-weight: 600; margin-bottom: 5px;">Supplier ${supplier.supplier_id}</div>
                    <div style="font-size: 0.8em; color: #666;">
                        ESG Score: ${supplier.esg_score} | 
                        Reliability: ${(supplier.reliability_score * 100).toFixed(0)}%
                    </div>
                </div>
            `).join('');
            
            document.getElementById('supplierData').innerHTML = html || '❌ No supplier data available';
        }

        // Generate report
        function generateReport() {
            if (dashboardData.calculations.length === 0) {
                showAlert('error', '❌ No calculation data available for report');
                return;
            }

            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    totalCalculations: dashboardData.calculations.length,
                    totalEmissions: dashboardData.calculations.reduce((sum, calc) => sum + calc.total_emissions_kg_co2e, 0),
                    averageEmissions: dashboardData.calculations.reduce((sum, calc) => sum + calc.total_emissions_kg_co2e, 0) / dashboardData.calculations.length,
                    averageResponseTime: dashboardData.calculations.reduce((sum, calc) => sum + calc.responseTime, 0) / dashboardData.calculations.length
                },
                calculations: dashboardData.calculations
            };

            showAlert('success', `✅ Report generated with ${report.summary.totalCalculations} calculations`);
            console.log('Generated Report:', report);
        }

        // Export data
        function exportData() {
            if (dashboardData.calculations.length === 0) {
                showAlert('error', '❌ No data available for export');
                return;
            }

            const csvContent = [
                'Timestamp,Product,Origin,Destination,Transport,Quantity,Total_CO2_kg,Production_CO2_kg,Transport_CO2_kg,Response_Time_ms',
                ...dashboardData.calculations.map(calc => [
                    calc.timestamp.toISOString(),
                    calc.product_name || 'Unknown',
                    calc.origin_country || 'Unknown', 
                    calc.destination_country || 'Unknown',
                    calc.transport_mode || 'Unknown',
                    calc.quantity || 1,
                    calc.total_emissions_kg_co2e.toFixed(2),
                    calc.production_emissions.toFixed(2),
                    calc.transportation_emissions.toFixed(2),
                    calc.responseTime
                ].join(','))
            ].join('\\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `greenalpha_carbon_data_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert('success', `✅ Data exported (${dashboardData.calculations.length} records)`);
        }

        // Start performance monitoring
        function startPerformanceMonitoring() {
            setInterval(async () => {
                try {
                    const startTime = Date.now();
                    const response = await fetch(`${API_BASE}/health`);
                    const responseTime = Date.now() - startTime;
                    
                    if (response.ok) {
                        updatePerformanceChart(responseTime);
                    }
                } catch (error) {
                    console.error('Health check failed:', error);
                }
            }, 10000); // Every 10 seconds
        }

        // Show alert messages
        function showAlert(type, message) {
            // Remove existing alerts
            const existingAlerts = document.querySelectorAll('.alert');
            existingAlerts.forEach(alert => alert.remove());

            // Create new alert
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;

            // Insert after control panel
            const controlPanel = document.querySelector('.control-panel');
            controlPanel.parentNode.insertBefore(alert, controlPanel.nextSibling);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Initialize with demo calculation
        setTimeout(() => {
            calculateCarbon();
        }, 1000);
    </script>
</body>
</html>